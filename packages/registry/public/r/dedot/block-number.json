{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "block-number",
  "type": "registry:component",
  "title": "Block Number",
  "description": "A block number component optimized for dedot. Fast, type-safe, and efficient.",
  "dependencies": [
    "dedot"
  ],
  "registryDependencies": [
    "button"
  ],
  "files": [
    {
      "path": "registry/dot-ui/blocks/block-number/page.dedot.tsx",
      "content": "import { PolkadotProvider } from \"@/registry/dot-ui/providers/dedot-provider\";\nimport { BlockNumber } from \"@/registry/dot-ui/blocks/block-number/components/block-number.dedot\";\n\nexport default function BlockNumberPage() {\n  return (\n    <PolkadotProvider>\n      <BlockNumber />\n    </PolkadotProvider>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/dot-ui/block-number/page.tsx"
    },
    {
      "path": "registry/dot-ui/blocks/block-number/components/block-number.dedot.tsx",
      "content": "\"use client\";\n\nimport { useBlockNumber } from \"@/registry/dot-ui/blocks/block-number/hooks/use-block-number.dedot\";\nimport { useDedot } from \"@/registry/dot-ui/providers/dedot-provider\";\nimport { Button } from \"@/registry/dot-ui/ui/button\";\n\nexport function BlockNumber() {\n  const {\n    setApi,\n    availableChains,\n    isConnected,\n    isLoading,\n    currentChain,\n    chainName,\n  } = useDedot();\n\n  const { blockNumber, error } = useBlockNumber();\n\n  if (isLoading(currentChain)) {\n    return (\n      <div className=\"w-full max-w-md p-4 border rounded-md\">\n        <div className=\"mb-4\">\n          <h3 className=\"text-lg font-semibold\">Block Number</h3>\n          <p className=\"text-sm text-gray-600\">Loading...</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\"></div>\n          <span className=\"text-sm text-gray-600\">\n            Connecting to {chainName} using PAPI...\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"w-full max-w-md p-4 border border-red-500 rounded-md bg-red-50\">\n        <div className=\"mb-4\">\n          <h3 className=\"text-lg font-semibold text-red-800\">Block Number</h3>\n          <p className=\"text-sm text-red-600\">Error loading block number</p>\n        </div>\n        <div className=\"text-red-700 text-sm\">{error}</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full max-w-md rounded-md\">\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"text-3xl font-bold text-polkadot-pink\">\n            {blockNumber?.toLocaleString() || \"Loading...\"}\n          </div>\n          <div className=\"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded\">\n            PAPI\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <div className=\"text-sm text-gray-600\">\n            Current chain: <span className=\"font-mono\">{chainName}</span>\n          </div>\n\n          <div className=\"flex gap-2 flex-wrap\">\n            {availableChains.map((chainId) => (\n              <Button\n                key={chainId}\n                variant={chainId === currentChain ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setApi(chainId)}\n                disabled={isLoading(chainId)}\n              >\n                {chainId}\n                {isConnected(chainId) && (\n                  <span className=\"ml-1 text-xs text-green-600\">‚óè</span>\n                )}\n              </Button>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/dot-ui/blocks/block-number/hooks/use-block-number.dedot.ts",
      "content": "\"use client\";\nimport { useDedot } from \"@/registry/dot-ui/providers/dedot-provider\";\nimport { useEffect, useState } from \"react\";\n\nexport function useBlockNumber() {\n  const { api, isLoading, error, currentChain, isConnected } = useDedot();\n  const [blockNumber, setBlockNumber] = useState<number | null>(null);\n\n  useEffect(() => {\n    if (!api || isLoading(currentChain) || !isConnected(currentChain)) {\n      return;\n    }\n\n    let unsubscribe: (() => void) | undefined = () => {};\n    let isMounted = true;\n\n    const subscribeToBlockNumber = async () => {\n      try {\n        const dedotUnsubscribe = await api.query.system.number(\n          (blockNumber: number) => {\n            if (isMounted) {\n              setBlockNumber(blockNumber);\n            }\n          }\n        );\n        unsubscribe = dedotUnsubscribe;\n      } catch (error) {\n        console.error(\"Failed to subscribe to block number:\", error);\n      }\n    };\n\n    subscribeToBlockNumber();\n\n    return () => {\n      isMounted = false;\n      unsubscribe?.();\n    };\n  }, [api, currentChain, isLoading, isConnected]);\n\n  return {\n    blockNumber,\n    isLoading: isLoading(currentChain),\n    error,\n  };\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "registry/dot-ui/providers/dedot-provider.tsx",
      "content": "\"use client\";\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { ChainId, dotUiConfig } from \"@/registry/dot-ui/lib/config.dot-ui\";\nimport {\n  getChainIds,\n  getChainConfig,\n  isValidChainId,\n} from \"@/registry/dot-ui/lib/utils.polkadot-ui\";\nimport { DedotClient, WsProvider } from \"dedot\";\n\ninterface DedotContextValue {\n  // Current active chain and its API\n  currentChain: ChainId;\n  api: DedotClient | null;\n  isLoading: (chainId: ChainId) => boolean;\n  error: string | null;\n\n  // All APIs for all registered chains\n  apis: Partial<Record<ChainId, DedotClient>>;\n\n  // Function to switch active chain (type-safe)\n  setApi: (chainId: ChainId) => void;\n\n  // Connection management\n  disconnect: () => void;\n  isConnected: (chainId: ChainId) => boolean;\n\n  // Chain information\n  chainName: string | null;\n  availableChains: ChainId[];\n}\n\nconst DedotContext = createContext<DedotContextValue | undefined>(undefined);\n\ninterface DedotProviderProps {\n  children: React.ReactNode;\n}\n\nexport function PolkadotProvider({ children }: DedotProviderProps) {\n  const [currentChain, setCurrentChain] = useState<ChainId>(\n    dotUiConfig.defaultChain\n  );\n  const [apis, setApis] = useState<Partial<Record<ChainId, DedotClient>>>({});\n  const [clients, setClients] = useState<Map<ChainId, DedotClient>>(new Map());\n  const [loadingStates, setLoadingStates] = useState<Map<ChainId, boolean>>(\n    new Map()\n  );\n  const [errorStates, setErrorStates] = useState<Map<ChainId, string | null>>(\n    new Map()\n  );\n\n  // Initialize the default chain on mount\n  useEffect(() => {\n    initializeChain(dotUiConfig.defaultChain);\n  }, []);\n\n  const initializeChain = async (chainId: ChainId) => {\n    // Don't initialize if already connected\n    if (apis[chainId]) return;\n\n    setLoadingStates((prev) => new Map(prev).set(chainId, true));\n    setErrorStates((prev) => new Map(prev).set(chainId, null));\n\n    try {\n      const chainConfig = getChainConfig(dotUiConfig.chains, chainId);\n\n      // Validate that endpoints array exists and has at least one element\n      if (!chainConfig.endpoints || !chainConfig.endpoints[0]) {\n        throw new Error(\n          `Chain ${chainId} (${chainConfig.displayName}) has no endpoints configured. Please add at least one endpoint to the chain configuration.`\n        );\n      }\n\n      console.log(`Connecting to ${chainConfig.displayName} using dedot`);\n\n      const provider = new WsProvider(chainConfig.endpoints);\n      provider.on(\"connected\", (endpoint: string) => {\n        console.log(\"Connected Endpoint\", endpoint);\n      });\n\n      await provider.connect();\n\n      const client = await DedotClient.new({\n        provider,\n        cacheMetadata: true,\n      });\n\n      setClients((prev) => new Map(prev).set(chainId, client));\n      setApis((prev: Partial<Record<ChainId, DedotClient>>) => ({\n        ...prev,\n        [chainId]: client,\n      }));\n\n      console.log(`Successfully connected to ${chainConfig.displayName}`);\n    } catch (err) {\n      console.error(`Failed to initialize ${chainId}:`, err);\n      setErrorStates((prev) =>\n        new Map(prev).set(\n          chainId,\n          err instanceof Error\n            ? err.message\n            : \"Failed to initialize Polkadot API\"\n        )\n      );\n    } finally {\n      setLoadingStates((prev) => new Map(prev).set(chainId, false));\n    }\n  };\n\n  const setApi = (chainId: ChainId) => {\n    if (!isValidChainId(dotUiConfig.chains, chainId)) {\n      console.error(`Invalid chain ID: ${chainId}`);\n      return;\n    }\n\n    setCurrentChain(chainId);\n    // Initialize the chain if not already connected\n    if (!apis[chainId]) {\n      initializeChain(chainId);\n    }\n  };\n\n  const disconnect = () => {\n    // Handle async disconnect operations properly\n    Promise.all(\n      Array.from(clients.values()).map(async (client) => {\n        try {\n          await client.disconnect();\n        } catch (error) {\n          console.error(\"Error disconnecting client:\", error);\n        }\n      })\n    )\n      .then(() => {\n        console.log(\"All clients disconnected successfully\");\n      })\n      .catch((error) => {\n        console.error(\"Error during disconnect:\", error);\n      });\n\n    // Clear state immediately to maintain synchronous interface\n    setClients(new Map());\n    setApis({});\n    setLoadingStates(new Map());\n    setErrorStates(new Map());\n    setCurrentChain(dotUiConfig.defaultChain);\n  };\n\n  const isConnected = (chainId: ChainId): boolean => {\n    return !!apis[chainId];\n  };\n\n  const isLoading = (chainId: ChainId): boolean => {\n    return loadingStates.get(chainId) || false;\n  };\n\n  const currentChainConfig = getChainConfig(dotUiConfig.chains, currentChain);\n\n  const value: DedotContextValue = {\n    currentChain,\n    api: apis[currentChain] || null,\n    error: errorStates.get(currentChain) || null,\n    apis,\n    setApi,\n    disconnect,\n    isConnected,\n    isLoading,\n    chainName: currentChainConfig.displayName,\n    availableChains: getChainIds(dotUiConfig.chains),\n  };\n\n  return (\n    <DedotContext.Provider value={value}>{children}</DedotContext.Provider>\n  );\n}\n\nexport function useDedot(): DedotContextValue {\n  const context = useContext(DedotContext);\n  if (!context) {\n    throw new Error(\"useDedot must be used within a DedotProvider\");\n  }\n  return context;\n}\n\n// Type exports (matching polkadot provider)\nexport type { ChainId };\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/dot-ui/lib/utils.polkadot-ui.ts",
      "content": "import type { ChainConfig } from \"@/registry/dot-ui/lib/types.polkadot-ui\";\n\n// Generic helper functions that work with any polkadot config\nexport function getChainIds<T extends Record<string, ChainConfig>>(\n  chains: T\n): (keyof T)[] {\n  return Object.keys(chains) as (keyof T)[];\n}\n\nexport function getChainConfig<\n  T extends Record<string, ChainConfig>,\n  K extends keyof T,\n>(chains: T, chainId: K): T[K] {\n  return chains[chainId];\n}\n\nexport function isValidChainId<T extends Record<string, ChainConfig>>(\n  chains: T,\n  chainId: string\n): chainId is string & keyof T {\n  return chainId in chains;\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/dot-ui/lib/types.polkadot-ui.ts",
      "content": "import type { ChainDefinition } from \"polkadot-api\";\n\n// interfaces related to dot-ui\nexport interface ChainConfig {\n  readonly endpoints: string[];\n  readonly displayName: string;\n  readonly isTestnet: boolean;\n  readonly icon?: string;\n  readonly explorerUrls?: Partial<Record<SubstrateExplorer, string>>;\n  readonly faucetUrls?: string[];\n}\n\nexport interface DotUiConfig {\n  readonly chains: Record<string, ChainConfig>;\n  readonly defaultChain: string;\n}\n\nexport interface PapiConfig extends ChainConfig {\n  readonly descriptor: ChainDefinition;\n}\n\nexport interface PolkadotConfig<\n  TChains extends Readonly<Record<string, ChainConfig>> = Readonly<\n    Record<string, ChainConfig>\n  >,\n> {\n  readonly chains: TChains;\n  readonly defaultChain: keyof TChains;\n}\n\nexport function definePolkadotConfig<\n  const TChains extends Readonly<Record<string, ChainConfig>>,\n>(config: PolkadotConfig<TChains>) {\n  return config;\n}\n\n// interfaces related to dedot\nexport enum SubstrateExplorer {\n  Subscan = \"subscan\",\n  PolkadotJs = \"polkadot-js\",\n  PapiExplorer = \"papi-explorer\",\n}\n\nexport enum JsonRpcApi {\n  LEGACY = \"legacy\",\n  NEW = \"new\",\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/dot-ui/lib/config.dot-ui.ts",
      "content": "import { DotUiConfig, SubstrateExplorer } from \"./types.polkadot-ui\";\n\nexport const dotUiConfig: DotUiConfig = {\n  chains: {\n    paseo_asset_hub: {\n      endpoints: [\n        \"wss://sys.ibp.network/asset-hub-paseo\",\n        \"wss://asset-hub-paseo.dotters.network\",\n      ],\n      displayName: \"Paseo Asset Hub\",\n      explorerUrls: {\n        [SubstrateExplorer.PolkadotJs]: `https://polkadot.js.org/apps/?rpc=${encodeURIComponent(\"wss://sys.ibp.network/asset-hub-paseo\")}#/explorer`,\n      },\n      isTestnet: true,\n    },\n    paseo: {\n      endpoints: [\"wss://sys.ibp.network/paseo\", \"wss://paseo.dotters.network\"],\n      displayName: \"Paseo Relay Chain\",\n      explorerUrls: {\n        [SubstrateExplorer.PolkadotJs]: `https://polkadot.js.org/apps/?rpc=${encodeURIComponent(\"wss://sys.ibp.network/paseo\")}#/explorer`,\n      },\n      isTestnet: true,\n    },\n  },\n  defaultChain: \"paseo_asset_hub\",\n};\n\n// Simple type aliases for type safety\nexport type ChainId = keyof typeof dotUiConfig.chains;\nexport type ChainConfig<T extends ChainId> = (typeof dotUiConfig.chains)[T];\n",
      "type": "registry:lib"
    }
  ]
}